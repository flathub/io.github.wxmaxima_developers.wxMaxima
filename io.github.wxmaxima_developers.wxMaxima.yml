app-id: io.github.wxmaxima_developers.wxMaxima
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: wxmaxima
finish-args:
  - --share=ipc
  - --socket=x11
  - --filesystem=home:rw
  - --share=network
  - --env=PATH=/usr/bin:/app/bin:/app/plugins/maxima/bin
add-extensions:
  io.github.wxmaxima_developers.wxMaxima.Plugin:
    versions: stable;test;master
    directory: plugins
    subdirectories: true
    no-autodownload: false
    autodelete: true
    add-ld-path: lib

modules:
  - name: extensions
    buildsystem: simple
    build-commands:
      - install -d /app/plugins
        
  - name: wxwidgets
    buildsystem: autotools
    no-autogen: true
    config-opts:
      - --with-gtk=3
      - --enable-webview
      - --enable-webviewwebkit
    sources:
      - type: git
        url: https://github.com/wxWidgets/wxWidgets.git
        commit: 49c6810948f40c457e3d0848b9111627b5b61de5
        tag: v3.3.1
  - name: gnuplot
    buildsystem: autotools
    no-autogen: true
    config-opts:
      - --with-qt=no
      - --with-wx=/app/bin
      - --without-latex  
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/gnuplot/6.0.3/gnuplot-6.0.3.tar.gz
        sha256: ec52e3af8c4083d4538152b3f13db47f6d29929a3f6ecec5365c834e77f251ab
  - name: wxmaxima
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DwxWidgets_INCLUDE_DIRS=/app/include/wx-3.2 
      - -DwxWidgets_LIBRARIES=/app/lib
      - -DWXM_DISABLE_WEBVIEW=OFF
      - -DCMAKE_BUILD_TYPE=Release
    post-install:
      - rm -r /app/share/icons/hicolor/1024x1024
    sources:
      - type: git
        url: https://github.com/wxMaxima-developers/wxmaxima.git
        commit: 494157478385c115d16d9ae9d1ef23e9ed835a81
        
cleanup-commands:
  - rm -r /app/include
  - rm /app/bin/wx-config /app/bin/wxrc /app/bin/wxrc-3.2
