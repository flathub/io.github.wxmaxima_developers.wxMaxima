app-id: io.github.wxmaxima_developers.wxMaxima
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: wxmaxima
finish-args:
  - --share=ipc
  - --socket=x11
  - --filesystem=home:rw
  - --share=network
  - --env=PATH=/usr/bin:/app/bin:/app/plugins/maxima/bin
add-extensions:
  io.github.wxmaxima_developers.wxMaxima.Plugin:
    versions: stable;test;master
    directory: plugins
    subdirectories: true
    no-autodownload: false
    autodelete: true
    add-ld-path: lib

modules:
  - name: extensions
    buildsystem: simple
    build-commands:
      - install -d /app/plugins
        
  - name: wxwidgets
    buildsystem: autotools
    no-autogen: true
    config-opts:
      - --with-gtk=3
      - --enable-webview
      - --enable-webviewwebkit
    sources:
      - type: git
        url: https://github.com/wxWidgets/wxWidgets.git
        commit: 8aef5f40b93958719771331ca03866b7b6fff6bf
        tag: v3.2.8
  - name: gnuplot
    buildsystem: autotools
    no-autogen: true
    config-opts:
      - --with-qt=no
      - --with-wx=/app/bin
      - --without-latex  
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/gnuplot/6.0.3/gnuplot-6.0.3-c23.tar.gz
        sha256: dab1b3aaa6146d73ec4d022d20ddf4be124c27d03a52ca2d9577f05336d3bf2e
  - name: wxmaxima
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DwxWidgets_INCLUDE_DIRS=/app/include/wx-3.2 
      - -DwxWidgets_LIBRARIES=/app/lib
      - -DWXM_DISABLE_WEBVIEW=OFF
      - -DCMAKE_BUILD_TYPE=Release
    post-install:
      - rm -r /app/share/icons/hicolor/1024x1024
    sources:
      - type: git
        url: https://github.com/wxMaxima-developers/wxmaxima.git
        # tag: Version-25.04.0
        commit: 7691d07e3f1aab00ce10ced43c2c7b0150b068b4
        
cleanup-commands:
  - rm -r /app/include
  - rm /app/bin/wx-config /app/bin/wxrc /app/bin/wxrc-3.2
